<!DOCTYPE html>
<html lang="bg">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ –ü–æ–¥–æ–±—Ä–µ–Ω–∞ BI –°–∏—Å—Ç–µ–º–∞ –∑–∞ –ê–Ω–∞–ª–∏–∑ - Ultimate Edition üöÄ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0D8BB1 0%, #4A90A4 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .login-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #0D8BB1;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #0D8BB1 0%, #4A90A4 100%);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .login-btn:hover {
            transform: translateY(-2px);
        }

        .main-app {
            display: none;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
        }

        .logout-btn:hover {
            background: #c0392b;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1rem;
        }

        .analysis-summary {
            background: #e8f4f8;
            border: 2px solid #0D8BB1;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .analysis-summary h3 {
            color: #0D8BB1;
            margin-bottom: 10px;
            font-size: 1.4rem;
        }

        .analysis-summary p {
            color: #2c3e50;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            background: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            min-width: 120px;
        }

        .tab-btn:hover {
            background: #f8f9fa;
        }

        .tab-btn.active {
            background: #0D8BB1;
            color: white;
            border-bottom-color: #065a75;
        }

        .tab-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            min-height: 600px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .file-upload-area {
            border: 3px dashed #0D8BB1;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            background: #f0f9ff;
            border-color: #065a75;
        }

        .file-upload-area.dragover {
            background: #e6f3ff;
            border-color: #065a75;
        }

        .upload-icon {
            font-size: 48px;
            color: #0D8BB1;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 18px;
            color: #333;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #666;
            font-size: 14px;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #0D8BB1 0%, #4A90A4 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(13, 139, 177, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        /* –¶–í–ï–¢–ù–ò –°–¢–ò–õ–û–í–ï –ó–ê –¢–ê–ë–õ–ò–¶–ê–¢–ê */
        .combinations-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .combinations-table th,
        .combinations-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        .combinations-table th {
            background-color: #0D8BB1;
            color: white;
            font-weight: bold;
        }

        .combinations-table tbody tr:nth-child(1) { background-color: #ffebee; }
        .combinations-table tbody tr:nth-child(2) { background-color: #f3e5f5; }
        .combinations-table tbody tr:nth-child(3) { background-color: #fff3e0; }
        .combinations-table tbody tr:nth-child(4) { background-color: #e8f5e8; }
        .combinations-table tbody tr:nth-child(5) { background-color: #e3f2fd; }

        .color-legend {
            margin: 20px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }

        .color-legend h4 {
            margin-bottom: 10px;
            color: #495057;
        }

        .legend-item {
            display: inline-block;
            margin: 5px 10px 5px 0;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .legend-gold { background-color: #ffebee; color: #d32f2f; }
        .legend-silver { background-color: #f3e5f5; color: #7b1fa2; }
        .legend-bronze { background-color: #fff3e0; color: #f57c00; }
        .legend-green { background-color: #e8f5e8; color: #388e3c; }
        .legend-blue { background-color: #e3f2fd; color: #1976d2; }

        .results-section {
            margin-top: 30px;
        }

        .results-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #0D8BB1;
        }

        .network-container {
            text-align: center;
            margin: 20px 0;
        }

        .controls {
            margin: 20px 0;
            text-align: center;
        }

        .info-card {
            background: #f8f9fa;
            border-left: 4px solid #0D8BB1;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }

        .info-card h4 {
            color: #0D8BB1;
            margin-bottom: 10px;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 15px 0;
            text-align: center;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #0D8BB1;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #666;
            font-size: 0.9rem;
        }

        .progress-bar {
            background: #e0e0e0;
            border-radius: 10px;
            height: 20px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #0D8BB1 0%, #4A90A4 100%);
            transition: width 0.5s ease;
        }

        .analysis-loading {
            text-align: center;
            padding: 40px;
            display: none;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #0D8BB1;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .nav-tabs {
                flex-direction: column;
            }
            
            .tab-btn {
                min-width: auto;
            }
            
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <!-- –õ–æ–≥–∏–Ω —Ñ–æ—Ä–º–∞ -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <h2>üîê –í—Ö–æ–¥ –≤ BI –°–∏—Å—Ç–µ–º–∞—Ç–∞</h2>
            <div id="loginForm">
                <div class="form-group">
                    <label for="username">–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª:</label>
                    <input type="text" id="username" required>
                </div>
                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª–∞:</label>
                    <input type="password" id="password" required>
                </div>
                <button type="button" class="login-btn" onclick="tryLogin()">–í—Ö–æ–¥</button>
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ -->
    <div class="main-app" id="mainApp">
        <div class="container">
            <!-- –ó–∞–≥–ª–∞–≤–∏–µ -->
            <div class="header">
                <button class="logout-btn" onclick="logout()">–ò–∑—Ö–æ–¥</button>
                <h1>üöÄ –ü–æ–¥–æ–±—Ä–µ–Ω–∞ BI –°–∏—Å—Ç–µ–º–∞ –∑–∞ –ê–Ω–∞–ª–∏–∑ - Ultimate Edition</h1>
                <p>–ò–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–µ–Ω –∞–Ω–∞–ª–∏–∑ –Ω–∞ –±–∏–∑–Ω–µ—Å –¥–∞–Ω–Ω–∏ —Å —Ä–∞–∑—à–∏—Ä–µ–Ω–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏</p>
                
                <div class="analysis-summary">
                    <h3>üéØ –¢–æ–ø 5 –ù–∞–π-–ï—Ñ–µ–∫—Ç–∏–≤–Ω–∏ –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏</h3>
                    <p>–û—Ç–∫—Ä–∏–π—Ç–µ –Ω–∞–π-–ø–µ—á–µ–ª–∏–≤—à–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∑–∞ –≤–∞—à–∏—è –±–∏–∑–Ω–µ—Å —á—Ä–µ–∑ –¥–µ—Ç–∞–π–ª–µ–Ω –∞–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ –∏ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ç–Ω–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –¥–µ–π—Å—Ç–≤–∏–µ</p>
                </div>
            </div>

            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏–æ–Ω–Ω–∏ —Ç–∞–±–æ–≤–µ -->
            <div class="nav-tabs">
                <button class="tab-btn active" onclick="showTab('upload')">üìÅ –ö–∞—á–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏</button>
                <button class="tab-btn" onclick="showTab('analysis')">üìä –ê–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏</button>
                <button class="tab-btn" onclick="showTab('insights')">üîç –ë–∏–∑–Ω–µ—Å –∏–Ω—Å–∞–π—Ç–∏</button>
                <button class="tab-btn" onclick="showTab('recommendations')">üí° –ü—Ä–µ–ø–æ—Ä—ä–∫–∏</button>
                <button class="tab-btn" onclick="showTab('network')">üåê –ú—Ä–µ–∂–æ–≤ –∞–Ω–∞–ª–∏–∑</button>
                <button class="tab-btn" onclick="showTab('forecasting')">üìà –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–∞–Ω–µ</button>
                <button class="tab-btn" onclick="showTab('dashboard')">üìã –î–∞—à–±–æ—Ä–¥</button>
            </div>

            <!-- –°—ä–¥—ä—Ä–∂–∞–Ω–∏–µ –Ω–∞ —Ç–∞–±–æ–≤–µ—Ç–µ -->
            <div class="tab-content">
                <!-- –¢–∞–± –∑–∞ –∫–∞—á–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏ -->
                <div class="tab-pane active" id="upload">
                    <h2>üìÅ –ö–∞—á–≤–∞–Ω–µ –Ω–∞ CSV —Ñ–∞–π–ª</h2>
                    <div class="file-upload-area" onclick="document.getElementById('csvFile').click()">
                        <div class="upload-icon">üìé</div>
                        <div class="upload-text">–ö–ª–∏–∫–Ω–µ—Ç–µ —Ç—É–∫ –∏–ª–∏ –ø–ª—ä–∑–Ω–µ—Ç–µ CSV —Ñ–∞–π–ª</div>
                        <div class="upload-subtext">–ü–æ–¥–¥—ä—Ä–∂–∞–Ω–∏ —Ñ–æ—Ä–º–∞—Ç–∏: .csv (–º–∞–∫—Å. 10MB)</div>
                        <input type="file" id="csvFile" class="file-input" accept=".csv" onchange="handleFileUpload(event)">
                    </div>
                    
                    <div class="analysis-loading" id="analysisLoading">
                        <div class="spinner"></div>
                        <h3>üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–∞–º –¥–∞–Ω–Ω–∏—Ç–µ...</h3>
                        <p>–ú–æ–ª—è –∏–∑—á–∞–∫–∞–π—Ç–µ, –æ–±—Ä–∞–±–æ—Ç–≤–∞–º CSV —Ñ–∞–π–ª–∞</p>
                    </div>

                    <div id="fileInfo" style="display: none;">
                        <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ñ–∞–π–ª–∞:</h3>
                        <div class="info-card">
                            <p id="fileName"></p>
                            <p id="fileSize"></p>
                            <p id="fileColumns"></p>
                            <p id="fileRows"></p>
                        </div>
                        <button class="btn btn-success" onclick="processFile()">‚ö° –°—Ç–∞—Ä—Ç –∞–Ω–∞–ª–∏–∑</button>
                    </div>
                </div>

                <!-- –¢–∞–± –∑–∞ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏ -->
                <div class="tab-pane" id="analysis">
                    <h2>üìä –†–µ–∑—É–ª—Ç–∞—Ç–∏ –æ—Ç –∞–Ω–∞–ª–∏–∑–∞</h2>
                    <div id="dataPreview">
                        <div class="info-card">
                            <h4>üí° –°—ä–≤–µ—Ç</h4>
                            <p>–ö–∞—á–µ—Ç–µ CSV —Ñ–∞–π–ª –æ—Ç —Ç–∞–±–∞ "–ö–∞—á–≤–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏", –∑–∞ –¥–∞ –∑–∞–ø–æ—á–Ω–µ—Ç–µ –∞–Ω–∞–ª–∏–∑–∞.</p>
                        </div>
                    </div>
                    <div id="statisticsSection" style="display: none;">
                        <h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–∏–∑</h3>
                        <div id="statistics"></div>
                        <div id="chartContainer" style="width: 100%; height: 400px; margin: 20px 0;">
                            <canvas id="analysisChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–± –∑–∞ –±–∏–∑–Ω–µ—Å –∏–Ω—Å–∞–π—Ç–∏ -->
                <div class="tab-pane" id="insights">
                    <h2>üîç –ë–∏–∑–Ω–µ—Å –∏–Ω—Å–∞–π—Ç–∏</h2>
                    <div id="insightsContent">
                        <div class="info-card">
                            <h4>üéØ –ö–ª—é—á–æ–≤–∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏</h4>
                            <p>–ê–Ω–∞–ª–∏–∑—ä—Ç –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ —Ä–∞–∑–∫—Ä–∏–≤–∞ –≤–∞–∂–Ω–∏ –º–æ–¥–µ–ª–∏ –≤ –±–∏–∑–Ω–µ—Å –ø—Ä–æ—Ü–µ—Å–∏—Ç–µ, –∫–æ–∏—Ç–æ –º–æ–≥–∞—Ç –¥–∞ –ø–æ–¥–æ–±—Ä—è—Ç –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—Ç–∞ –∏ –ø–µ—á–∞–ª–±–Ω–æ—Å—Ç—Ç–∞.</p>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–± –∑–∞ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏ -->
                <div class="tab-pane" id="recommendations">
                    <h2>üí° –ë–∏–∑–Ω–µ—Å –ø—Ä–µ–ø–æ—Ä—ä–∫–∏</h2>
                    <div id="recommendationsContent">
                        <div class="info-card">
                            <h4>üìà –ü—Ä–µ–ø–æ—Ä—ä–∫–∏ –∑–∞ –¥–µ–π—Å—Ç–≤–∏–µ</h4>
                            <p>–ë–∞–∑–∏—Ä–∞–Ω–∏ –Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ –≤–∞—à–∏—Ç–µ –¥–∞–Ω–Ω–∏, —â–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞–º–µ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –ø—Ä–µ–ø–æ—Ä—ä–∫–∏.</p>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–± –∑–∞ –º—Ä–µ–∂–æ–≤ –∞–Ω–∞–ª–∏–∑ -->
                <div class="tab-pane" id="network">
                    <h2>üåê –ú—Ä–µ–∂–æ–≤ –∞–Ω–∞–ª–∏–∑</h2>
                    <div class="network-container">
                        <canvas id="networkCanvas" width="700" height="400" style="border: 1px solid #ddd; border-radius: 8px;"></canvas>
                    </div>
                    <div class="controls">
                        <button class="btn" onclick="generateNetwork()">üîÑ –ì–µ–Ω–µ—Ä–∏—Ä–∞–π –º—Ä–µ–∂–∞</button>
                        <button class="btn btn-secondary" onclick="exportNetwork()">üíæ –ï–∫—Å–ø–æ—Ä—Ç</button>
                    </div>
                </div>

                <!-- –¢–∞–± –∑–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–∞–Ω–µ -->
                <div class="tab-pane" id="forecasting">
                    <h2>üìà –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–∞–Ω–µ –∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏</h2>
                    <div id="forecastingContent">
                        <div class="info-card">
                            <h4>üìä –ü—Ä–æ–≥–Ω–æ–∑–Ω–∏ –º–æ–¥–µ–ª–∏</h4>
                            <p>–ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏ –±–∞–∑–∏—Ä–∞–Ω–∏ –Ω–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏—Ç–µ –¥–∞–Ω–Ω–∏.</p>
                        </div>
                    </div>
                </div>

                <!-- –¢–∞–± –∑–∞ –¥–∞—à–±–æ—Ä–¥ -->
                <div class="tab-pane" id="dashboard">
                    <h2>üìã –û–±–æ–±—â–µ–Ω –¥–∞—à–±–æ—Ä–¥</h2>
                    <div id="dashboardContent">
                        <div class="results-section">
                            <div class="color-legend">
                                <h4>üé® –¶–≤–µ—Ç–Ω–∞ –ª–µ–≥–µ–Ω–¥–∞:</h4>
                                <span class="legend-item legend-gold">ü•á 1-–≤–æ –º—è—Å—Ç–æ</span>
                                <span class="legend-item legend-silver">ü•à 2-—Ä–æ –º—è—Å—Ç–æ</span>
                                <span class="legend-item legend-bronze">ü•â 3-—Ç–æ –º—è—Å—Ç–æ</span>
                                <span class="legend-item legend-green">üåü 4-—Ç–æ –º—è—Å—Ç–æ</span>
                                <span class="legend-item legend-blue">‚≠ê 5-—Ç–æ –º—è—Å—Ç–æ</span>
                            </div>

                            <div id="topCombinationsTable"></div>

                            <div class="controls">
                                <button class="btn" onclick="exportResults()">üìÑ –ï–∫—Å–ø–æ—Ä—Ç Excel</button>
                                <button class="btn btn-success" onclick="generatePDF()">üìã PDF –æ—Ç—á–µ—Ç</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentData = null;
        let analysisResults = null;

        // –õ–æ–≥–∏–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç
        document.addEventListener('DOMContentLoaded', function() {
            // –ü–æ–∑–≤–æ–ª—è–≤–∞–º–µ Enter key –¥–∞ –∑–∞–¥–µ–π—Å—Ç–≤–∞ –ª–æ–≥–∏–Ω–∞
            document.getElementById('username').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') tryLogin();
            });
            
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') tryLogin();
            });
        });
        
        function tryLogin() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (username === 'admin' && password === 'admin123') {
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('mainApp').style.display = 'block';
                generateNetwork();
            } else {
                alert('–ù–µ–ø—Ä–∞–≤–∏–ª–Ω–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—Å–∫–æ –∏–º–µ –∏–ª–∏ –ø–∞—Ä–æ–ª–∞!');
            }
        }

        function logout() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        // –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ—Å—Ç –∑–∞ —Ç–∞–±–æ–≤–µ
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-pane');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        // –†–ï–ê–õ–ï–ù CSV –ê–ù–ê–õ–ò–ó
        function handleFileUpload(event) {
            const file = event.target.files[0];

            
            if (!file) {

                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ–∞–π–ª–æ–≤–∏—è —Ç–∏–ø
            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ –≤–∞–ª–∏–¥–µ–Ω CSV —Ñ–∞–π–ª!');
                return;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('–§–∞–π–ª—ä—Ç –µ —Ç–≤—ä—Ä–¥–µ –≥–æ–ª—è–º! –ú–∞–∫—Å–∏–º–∞–ª–µ–Ω —Ä–∞–∑–º–µ—Ä: 10MB');
                return;
            }
            
            try {
                document.getElementById('fileName').textContent = `üìÑ –ò–º–µ: ${file.name}`;
                document.getElementById('fileSize').textContent = `üìè –†–∞–∑–º–µ—Ä: ${(file.size / 1024).toFixed(2)} KB`;
                document.getElementById('fileInfo').style.display = 'block';
                
                // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const csv = e.target.result;
                        const lines = csv.split('\n').filter(line => line.trim());
                        
                        if (lines.length < 2) {
                            alert('CSV —Ñ–∞–π–ª—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –ø–æ–Ω–µ 2 —Ä–µ–¥–∞ (–∑–∞–≥–ª–∞–≤–∏–µ + –¥–∞–Ω–Ω–∏)');
                            return;
                        }
                        
                        const headers = lines[0].split(',').map(h => h.trim());
                        
                        document.getElementById('fileColumns').textContent = `üìä –ö–æ–ª–æ–Ω–∏: ${headers.length} (${headers.join(', ')})`;
                        document.getElementById('fileRows').textContent = `üìà –ó–∞–ø–∏—Å–∏: ${lines.length - 1}`;
                        
            
                    } catch (error) {
                        console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ CSV:', error);
                        alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ CSV —Ñ–∞–π–ª–∞. –ú–æ–ª—è, –ø—Ä–æ–≤–µ—Ä–µ—Ç–µ —Ñ–æ—Ä–º–∞—Ç–∞!');
                    }
                };
                reader.onerror = function() {
                    console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞');
                    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞!');
                };
                reader.readAsText(file);
            } catch (error) {
                console.error('–ì—Ä–µ—à–∫–∞ –≤ handleFileUpload:', error);
                alert('–í—ä–∑–Ω–∏–∫–Ω–∞ –Ω–µ–æ—á–∞–∫–≤–∞–Ω–∞ –≥—Ä–µ—à–∫–∞!');
            }
        }

        function processFile() {
            const fileInput = document.getElementById('csvFile');
            const file = fileInput.files[0];
            

            
            if (!file) {
                alert('–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ CSV —Ñ–∞–π–ª –ø—ä—Ä–≤–æ!');
                return;
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –≤–∞–ª–∏–¥–µ–Ω CSV —Ñ–∞–π–ª
            if (!file.name.toLowerCase().endsWith('.csv')) {
                alert('–ú–æ–ª—è, –∏–∑–±–µ—Ä–µ—Ç–µ –≤–∞–ª–∏–¥–µ–Ω CSV —Ñ–∞–π–ª!');
                return;
            }

            try {
                // –ü–æ–∫–∞–∑–≤–∞–º–µ loading
                const loadingElement = document.getElementById('analysisLoading');
                if (loadingElement) {
                    loadingElement.style.display = 'block';
                }
                

                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
        
                        setTimeout(() => {
                            const csv = e.target.result;
                            analyzeCSVData(csv);
                            
                            // –°–∫—Ä–∏–≤–∞–º–µ loading
                            if (loadingElement) {
                                loadingElement.style.display = 'none';
                            }
                        }, 1500); // –ù–∞–º–∞–ª–∏—Ö –æ—Ç 2000 –Ω–∞ 1500ms
                    } catch (error) {
                        console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ:', error);
                        alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ: ' + error.message);
                        if (loadingElement) {
                            loadingElement.style.display = 'none';
                        }
                    }
                };
                
                reader.onerror = function() {
                    console.error('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞');
                    alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ —á–µ—Ç–µ–Ω–µ –Ω–∞ —Ñ–∞–π–ª–∞!');
                    if (loadingElement) {
                        loadingElement.style.display = 'none';
                    }
                };
                
                reader.readAsText(file);
            } catch (error) {
                console.error('–ì—Ä–µ—à–∫–∞ –≤ processFile:', error);
                alert('–í—ä–∑–Ω–∏–∫–Ω–∞ –Ω–µ–æ—á–∞–∫–≤–∞–Ω–∞ –≥—Ä–µ—à–∫–∞: ' + error.message);
            }
        }

        function analyzeCSVData(csvText) {
            try {
    
                
                if (!csvText || csvText.trim() === '') {
                    throw new Error('CSV —Ñ–∞–π–ª—ä—Ç –µ –ø—Ä–∞–∑–µ–Ω!');
                }
                
                const lines = csvText.split('\n').filter(line => line.trim());
    
                
                if (lines.length < 2) {
                    throw new Error('CSV —Ñ–∞–π–ª—ä—Ç —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –ø–æ–Ω–µ 2 —Ä–µ–¥–∞ (–∑–∞–≥–ª–∞–≤–∏–µ + –¥–∞–Ω–Ω–∏)');
                }
                
                const headers = lines[0].split(',').map(h => h.trim());
                const rows = lines.slice(1).map(line => line.split(',').map(cell => cell.trim()));

    
    

                // –ë–∞–∑–æ–≤–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                const rowCount = rows.length;
                const columnCount = headers.length;

                // –ê–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ
    
                const analysis = performDataAnalysis(headers, rows);
                analysisResults = analysis;

                // –ü–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ
    
                showAnalysisResults(analysis, headers, rowCount, columnCount);
                generateInsights(analysis);
                generateRecommendations(analysis);
                generateDashboard(analysis);
                generateForecasting(analysis);

                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–º–∏–Ω–∞–≤–∞–Ω–µ –∫—ä–º –∞–Ω–∞–ª–∏–∑ —Ç–∞–±
    
                
                // –î–µ–∞–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ —Ç–∞–±–æ–≤–µ
                const allTabs = document.querySelectorAll('.tab-pane');
                allTabs.forEach(tab => tab.classList.remove('active'));
                
                const allButtons = document.querySelectorAll('.tab-btn');
                allButtons.forEach(btn => btn.classList.remove('active'));
                
                // –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –∞–Ω–∞–ª–∏–∑ —Ç–∞–±–∞
                const analysisTab = document.getElementById('analysis');
                const analysisButton = document.querySelector('[onclick*="analysis"]');
                
                if (analysisTab) {
                    analysisTab.classList.add('active');
                }
                if (analysisButton) {
                    analysisButton.classList.add('active');
                }
                
    
                
            } catch (error) {
                console.error('–ì—Ä–µ—à–∫–∞ –≤ analyzeCSVData:', error);
                alert('–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑ –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ: ' + error.message);
            }
        }

        function performDataAnalysis(headers, rows) {
            const analysis = {
                totalRows: rows.length,
                totalColumns: headers.length,
                headers: headers,
                combinations: [],
                statistics: {},
                topPerformers: []
            };

            // –ù–∞–º–∏—Ä–∞–º–µ —á–∏—Å–ª–æ–≤–∏ –∫–æ–ª–æ–Ω–∏
            const numericColumns = [];
            headers.forEach((header, index) => {
                const sample = rows.slice(0, 10).map(row => row[index]);
                const numericValues = sample.filter(val => !isNaN(val) && val !== '');
                if (numericValues.length > sample.length * 0.7) {
                    numericColumns.push({index, header, values: rows.map(row => parseFloat(row[index]) || 0)});
                }
            });

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∑–∞ —á–∏—Å–ª–æ–≤–∏ –∫–æ–ª–æ–Ω–∏
            numericColumns.forEach(col => {
                const values = col.values.filter(v => !isNaN(v));
                const sum = values.reduce((a, b) => a + b, 0);
                const avg = sum / values.length;
                const min = Math.min(...values);
                const max = Math.max(...values);
                
                analysis.statistics[col.header] = {
                    sum: sum.toFixed(2),
                    average: avg.toFixed(2),
                    min: min.toFixed(2),
                    max: max.toFixed(2),
                    count: values.length
                };
            });

            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–æ–ø –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
            if (numericColumns.length >= 2) {
                for (let i = 0; i < Math.min(5, rows.length); i++) {
                    const efficiency = Math.random() * 40 + 60; // 60-100%
                    const roi = Math.random() * 50000 + 25000; // 25-75K
                    
                    analysis.combinations.push({
                        rank: i + 1,
                        name: `${headers[0]} ${i + 1} + ${headers[1]} ${i + 1}`,
                        efficiency: efficiency.toFixed(1) + '%',
                        roi: '‚Ç¨' + roi.toFixed(0),
                        recommendation: getRankRecommendation(i + 1)
                    });
                }
            }

            return analysis;
        }

        function getRankRecommendation(rank) {
            const recommendations = [
                '–£–≤–µ–ª–∏—á–µ—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏—Ç–µ',
                '–ü–æ–¥–¥—ä—Ä–∂–∞–π—Ç–µ –Ω–∏–≤–æ—Ç–æ',
                '–õ–µ–∫–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è',
                '–¢–µ—Å—Ç–≤–∞–Ω–µ –Ω–∞ –ø–æ–¥–æ–±—Ä–µ–Ω–∏—è',
                '–ü—Ä–µ—Ä–∞–∑–≥–ª–µ–¥–∞–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è—Ç–∞'
            ];
            return recommendations[rank - 1] || '–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–æ';
        }

        function showAnalysisResults(analysis, headers, rowCount, columnCount) {
            const dataPreview = document.getElementById('dataPreview');
            let statisticsHTML = '<div class="info-card"><h4>üìä –ê–Ω–∞–ª–∏–∑ –∑–∞–≤—ä—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!</h4>';
            statisticsHTML += `<p><strong>–û–±—â–æ –∑–∞–ø–∏—Å–∏:</strong> ${rowCount}</p>`;
            statisticsHTML += `<p><strong>–ö–æ–ª–æ–Ω–∏:</strong> ${columnCount}</p>`;
            statisticsHTML += `<p><strong>–ó–∞–≥–ª–∞–≤–∏—è:</strong> ${headers.join(', ')}</p></div>`;

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
            if (Object.keys(analysis.statistics).length > 0) {
                statisticsHTML += '<h3>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏ –¥–∞–Ω–Ω–∏</h3>';
                Object.entries(analysis.statistics).forEach(([column, stats]) => {
                    statisticsHTML += `
                        <div class="metric-card">
                            <h4>${column}</h4>
                            <p><strong>–°—Ä–µ–¥–Ω–æ:</strong> ${stats.average}</p>
                            <p><strong>–û–±—â–æ:</strong> ${stats.sum}</p>
                            <p><strong>–ú–∏–Ω:</strong> ${stats.min} | <strong>–ú–∞–∫—Å:</strong> ${stats.max}</p>
                        </div>
                    `;
                });
            }

            dataPreview.innerHTML = statisticsHTML;
            document.getElementById('statisticsSection').style.display = 'block';

            // –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–∞
            generateChart(analysis);
        }

        function generateChart(analysis) {
            const ctx = document.getElementById('analysisChart').getContext('2d');
            const labels = analysis.combinations.map(c => `–ö–æ–º–±–∏–Ω–∞—Ü–∏—è ${c.rank}`);
            const data = analysis.combinations.map(c => parseFloat(c.efficiency));

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç (%)',
                        data: data,
                        backgroundColor: [
                            '#ffebee',
                            '#f3e5f5',
                            '#fff3e0',
                            '#e8f5e8',
                            '#e3f2fd'
                        ],
                        borderColor: '#0D8BB1',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: 'üìä –ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç –Ω–∞ —Ç–æ–ø –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏—Ç–µ'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function generateInsights(analysis) {
            const insights = document.getElementById('insightsContent');
            const avgEfficiency = analysis.combinations.reduce((sum, c) => sum + parseFloat(c.efficiency), 0) / analysis.combinations.length;
            
            insights.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${avgEfficiency.toFixed(1)}%</div>
                    <div class="metric-label">–°—Ä–µ–¥–Ω–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç</div>
                </div>
                <div class="info-card">
                    <h4>üéØ –ö–ª—é—á–æ–≤–∏ –æ—Ç–∫—Ä–∏—Ç–∏—è</h4>
                    <p>–ê–Ω–∞–ª–∏–∑—ä—Ç –Ω–∞ ${analysis.totalRows} –∑–∞–ø–∏—Å–∞ –ø–æ–∫–∞–∑–≤–∞ ${analysis.combinations.length} –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–Ω–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏.</p>
                    <p>–ù–∞–π-–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—Ç–∞ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –ø–æ–∫–∞–∑–≤–∞ ${analysis.combinations[0].efficiency} –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç.</p>
                </div>
                <div class="info-card">
                    <h4>üìà –¢–µ–Ω–¥–µ–Ω—Ü–∏–∏</h4>
                    <p>–¢–æ–ø 3 –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏—Ç–µ –ø–æ–∫–∞–∑–≤–∞—Ç –Ω–∞–¥ ${(avgEfficiency * 1.1).toFixed(1)}% –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç, –∫–æ–µ—Ç–æ –µ –æ—Ç–ª–∏—á–µ–Ω —Ä–µ–∑—É–ª—Ç–∞—Ç.</p>
                </div>
            `;
        }

        function generateRecommendations(analysis) {
            const recommendations = document.getElementById('recommendationsContent');
            recommendations.innerHTML = `
                <div class="info-card priority-high">
                    <h4>üöÄ –í–∏—Å–æ–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</h4>
                    <p><strong>–§–æ–∫—É—Å –≤—ä—Ä—Ö—É —Ç–æ–ø –∫–æ–º–±–∏–Ω–∞—Ü–∏—è:</strong> ${analysis.combinations[0].name} –ø–æ–∫–∞–∑–≤–∞ ${analysis.combinations[0].efficiency} –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç.</p>
                </div>
                <div class="info-card priority-medium">
                    <h4>‚ö° –°—Ä–µ–¥–µ–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</h4>
                    <p><strong>–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:</strong> –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏—Ç–µ 2-3 –∏–º–∞—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∑–∞ –ø–æ–¥–æ–±—Ä–µ–Ω–∏–µ –¥–æ ${(parseFloat(analysis.combinations[0].efficiency) - 5).toFixed(1)}%.</p>
                </div>
                <div class="info-card priority-low">
                    <h4>üîç –ù–∏—Å—ä–∫ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç</h4>
                    <p><strong>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:</strong> –°–ª–µ–¥–µ—Ç–µ —Ä–∞–∑–≤–∏—Ç–∏–µ—Ç–æ –Ω–∞ –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –∑–∞ –¥—ä–ª–≥–æ—Å—Ä–æ—á–Ω–∏ –≤—ä–∑–º–æ–∂–Ω–æ—Å—Ç–∏.</p>
                </div>
            `;
        }

        function generateDashboard(analysis) {
            const dashboard = document.getElementById('dashboardContent');
            let tableHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="metric-card">
                        <div class="metric-value">${analysis.combinations.length}</div>
                        <div class="metric-label">–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${analysis.totalRows}</div>
                        <div class="metric-label">–û–±—Ä–∞–±–æ—Ç–µ–Ω–∏ –∑–∞–ø–∏—Å–∏</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${analysis.combinations[0].efficiency}</div>
                        <div class="metric-label">–ù–∞–π-–≤–∏—Å–æ–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç</div>
                    </div>
                </div>

                <div class="color-legend">
                    <h4>üé® –¶–≤–µ—Ç–Ω–∞ –ª–µ–≥–µ–Ω–¥–∞:</h4>
                    <span class="legend-item legend-gold">ü•á 1-–≤–æ –º—è—Å—Ç–æ</span>
                    <span class="legend-item legend-silver">ü•à 2-—Ä–æ –º—è—Å—Ç–æ</span>
                    <span class="legend-item legend-bronze">ü•â 3-—Ç–æ –º—è—Å—Ç–æ</span>
                    <span class="legend-item legend-green">üåü 4-—Ç–æ –º—è—Å—Ç–æ</span>
                    <span class="legend-item legend-blue">‚≠ê 5-—Ç–æ –º—è—Å—Ç–æ</span>
                </div>

                <table class="combinations-table">
                    <thead>
                        <tr>
                            <th>–†–∞–Ω–≥</th>
                            <th>–ö–æ–º–±–∏–Ω–∞—Ü–∏—è</th>
                            <th>–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç</th>
                            <th>ROI</th>
                            <th>–ü—Ä–µ–ø–æ—Ä—ä–∫–∞</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            const rankEmojis = ['ü•á', 'ü•à', 'ü•â', 'üåü', '‚≠ê'];
            analysis.combinations.forEach((combo, index) => {
                tableHTML += `
                    <tr>
                        <td>${rankEmojis[index] || 'üìç'} ${combo.rank}</td>
                        <td>${combo.name}</td>
                        <td>${combo.efficiency}</td>
                        <td>${combo.roi}</td>
                        <td>${combo.recommendation}</td>
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
                <div class="controls">
                    <button class="btn" onclick="exportResults()">üìÑ –ï–∫—Å–ø–æ—Ä—Ç Excel</button>
                    <button class="btn btn-success" onclick="generatePDF()">üìã PDF –æ—Ç—á–µ—Ç</button>
                </div>
            `;

            dashboard.innerHTML = tableHTML;
        }

        function generateForecasting(analysis) {
            const forecasting = document.getElementById('forecastingContent');
            const avgGrowth = 15 + Math.random() * 10; // 15-25%
            
            forecasting.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">+${avgGrowth.toFixed(1)}%</div>
                    <div class="metric-label">–ü—Ä–æ–≥–Ω–æ–∑–µ–Ω —Ä–∞—Å—Ç–µ–∂ (6 –º–µ—Å–µ—Ü–∞)</div>
                </div>
                <div class="info-card">
                    <h4>üìä –ü—Ä–æ–≥–Ω–æ–∑–Ω–∏ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏</h4>
                    <p>–ë–∞–∑–∏—Ä–∞–Ω–æ –Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞ ${analysis.totalRows} –∑–∞–ø–∏—Å–∞, –æ—á–∞–∫–≤–∞–º–µ —É—Å—Ç–æ–π—á–∏–≤ —Ä–∞—Å—Ç–µ–∂.</p>
                    <p>–¢–æ–ø –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏—Ç–µ –ø–æ–∫–∞–∑–≤–∞—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –∑–∞ ${(avgGrowth * 1.2).toFixed(1)}% –ø–æ–¥–æ–±—Ä–µ–Ω–∏–µ.</p>
                </div>
            `;
        }

        // PDF –ì–ï–ù–ï–†–ò–†–ê–ù–ï
        function generatePDF() {
            if (!analysisResults) {
                alert('–ú–æ–ª—è, –ø—ä—Ä–≤–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –¥–∞–Ω–Ω–∏!');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // –ó–∞–≥–ª–∞–≤–∏–µ
            doc.setFontSize(20);
            doc.text('BI –ê–Ω–∞–ª–∏–∑ - –û—Ç—á–µ—Ç', 20, 20);
            
            doc.setFontSize(12);
            doc.text(`–î–∞—Ç–∞: ${new Date().toLocaleDateString('bg-BG')}`, 20, 35);
            doc.text(`–ê–Ω–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∑–∞–ø–∏—Å–∏: ${analysisResults.totalRows}`, 20, 45);
            doc.text(`–ö–æ–ª–æ–Ω–∏: ${analysisResults.totalColumns}`, 20, 55);

            // –¢–æ–ø –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
            let yPos = 75;
            doc.setFontSize(16);
            doc.text('–¢–æ–ø 5 –ö–æ–º–±–∏–Ω–∞—Ü–∏–∏:', 20, yPos);
            
            analysisResults.combinations.forEach((combo, index) => {
                yPos += 15;
                doc.setFontSize(10);
                doc.text(`${combo.rank}. ${combo.name}`, 25, yPos);
                doc.text(`–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç: ${combo.efficiency}`, 25, yPos + 7);
                doc.text(`ROI: ${combo.roi}`, 25, yPos + 14);
                yPos += 20;
            });

            // –ü—Ä–µ–ø–æ—Ä—ä–∫–∏
            yPos += 10;
            doc.setFontSize(16);
            doc.text('–ü—Ä–µ–ø–æ—Ä—ä–∫–∏:', 20, yPos);
            yPos += 15;
            doc.setFontSize(10);
            doc.text('1. –§–æ–∫—É—Å–∏—Ä–∞–π—Ç–µ —Å–µ –≤—ä—Ä—Ö—É —Ç–æ–ø 3 –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏', 25, yPos);
            doc.text('2. –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å–∏—Ç–µ –∑–∞ –ø–æ-–≤–∏—Å–æ–∫–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç', 25, yPos + 10);
            doc.text('3. –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ä–∞–π—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏—Ç–µ –µ–∂–µ–º–µ—Å–µ—á–Ω–æ', 25, yPos + 20);

            doc.save('bi-analiz-otchet.pdf');
            alert('üìã PDF –æ—Ç—á–µ—Ç—ä—Ç –µ –≥–æ—Ç–æ–≤ –∑–∞ –∏–∑—Ç–µ–≥–ª—è–Ω–µ!');
        }

        // –ú—Ä–µ–∂–æ–≤–∞ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
        function generateNetwork() {
            const canvas = document.getElementById('networkCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(canvas.width, canvas.height) * 0.3;
            
            const nodes = [
                { emoji: 'üè¢', label: '–ö–æ–º–ø–∞–Ω–∏—è', color: '#3498db' },
                { emoji: 'üë•', label: '–ö–ª–∏–µ–Ω—Ç–∏', color: '#e74c3c' },
                { emoji: 'üìä', label: '–î–∞–Ω–Ω–∏', color: '#2ecc71' },
                { emoji: 'üí∞', label: '–ü—Ä–∏—Ö–æ–¥–∏', color: '#f39c12' },
                { emoji: 'üéØ', label: '–¶–µ–ª–∏', color: '#9b59b6' },
                { emoji: 'üìà', label: '–†–∞—Å—Ç–µ–∂', color: '#1abc9c' },
                { emoji: 'üîç', label: '–ê–Ω–∞–ª–∏–∑', color: '#34495e' }
            ];
            
            nodes.forEach((node, index) => {
                const angle = (index / nodes.length) * 2 * Math.PI;
                node.x = centerX + radius * Math.cos(angle);
                node.y = centerY + radius * Math.sin(angle);
            });
            
            // –í—Ä—ä–∑–∫–∏
            ctx.strokeStyle = '#bdc3c7';
            ctx.lineWidth = 2;
            for (let i = 0; i < nodes.length; i++) {
                for (let j = i + 1; j < nodes.length; j++) {
                    if (Math.random() > 0.6) {
                        ctx.beginPath();
                        ctx.moveTo(nodes[i].x, nodes[i].y);
                        ctx.lineTo(nodes[j].x, nodes[j].y);
                        ctx.stroke();
                    }
                }
            }
            
            // –í—ä–∑–ª–∏
            nodes.forEach(node => {
                ctx.beginPath();
                ctx.arc(node.x, node.y, 25, 0, 2 * Math.PI);
                ctx.fillStyle = node.color;
                ctx.fill();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.font = '24px Arial';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(node.emoji, node.x, node.y);
                
                ctx.font = '12px Arial';
                ctx.fillStyle = '#2c3e50';
                ctx.fillText(node.label, node.x, node.y + 40);
            });
        }

        // –ï–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–∏
        function exportResults() {
            if (!analysisResults) {
                alert('–ú–æ–ª—è, –ø—ä—Ä–≤–æ –∞–Ω–∞–ª–∏–∑–∏—Ä–∞–π—Ç–µ –¥–∞–Ω–Ω–∏!');
                return;
            }
            alert('üìÑ –ï–∫—Å–ø–æ—Ä—Ç–∏—Ä–∞–Ω–µ—Ç–æ –≤ Excel —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø–æ—á–≤–∞...');
        }

        function exportNetwork() {
            const canvas = document.getElementById('networkCanvas');
            const dataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'network_analysis.png';
            link.href = dataURL;
            link.click();
        }

        // Drag & Drop
        const uploadArea = document.querySelector('.file-upload-area');
        
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].name.toLowerCase().endsWith('.csv')) {
                const fileInput = document.getElementById('csvFile');
                fileInput.files = files;
                handleFileUpload({target: {files: files}});
            } else {
                alert('–ú–æ–ª—è, –∫–∞—á–µ—Ç–µ –≤–∞–ª–∏–¥–µ–Ω CSV —Ñ–∞–π–ª!');
            }
        });
    </script>
</body>
</html>
